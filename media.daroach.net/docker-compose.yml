#daroach.net Docker Compose File.
# this runs my media collection
#Author: Gagan Daroach
#Date: May 25 2019

version: "2.3"

networks:
  backend:

services:
  plex:
    image: ghcr.io/linuxserver/plex:latest
    restart: "unless-stopped"
    runtime: nvidia
    ports:
      - 32400:32400
    networks:
      - backend
    environment:
      - TZ=${TZ}
      - PUID=${MEDIA_PUID}
      - PGID=${MEDIA_PGID}
      - VERSION=docker 
      - NVIDIA_VISIBLE_DEVICES=GPU-9ff54a75-3c2b-936f-db89-4c1db3fb218d
        #      - PLEX_CLAIM=
    volumes:
      - ${CONFIG_DIR}/plex:/config
      - ${TV_DIR}:/tv
      - ${MOVIES_DIR}:/movies
      - ${MUSIC_DIR}:/music

  transmission:
    image: haugene/transmission-openvpn
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    restart: always
    networks:
      - backend
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/transmission:/data
      - ${DOWNLOADS}/complete:/downloads/complete
      - ${DOWNLOADS}/incomplete:/downloads/incomplete
      - ${WATCH}:/watch
    env_file:
      - vpn.env
    dns:
      - 8.8.8.8
      - 8.8.4.4

  proxy:
    image: haugene/transmission-openvpn-proxy
    depends_on:
      - transmission
    ports:
      - 20010:8080
    volumes:
      - /etc/localtime:/etc/localtime:ro    
    networks:
      - backend

  # deluge:
  #   image: ghcr.io/linuxserver/deluge:latest
  #   restart: "unless-stopped"
  #   environment:
  #     - PUID=${MEDIA_PUID}
  #     - PGID=${MEDIA_PGID}
  #     - TZ=${TZ}
  #   volumes:
  #     - ${CONFIG_DIR}/deluge:/config
  #     - ${DOWNLOADS}/complete:/downloads/complete
  #     - ${DOWNLOADS}/incomplete:/downloads/incomplete
  #     - ${WATCH}:/watch
  #   ports:
  #     - 20010:8112
  #   networks:
  #     - backend

  jackett:
    image: ghcr.io/linuxserver/jackett:latest
    restart: "unless-stopped"
    networks:
      - backend
    ports:
      - 20011:9117
    environment:
      - PUID=${MEDIA_PUID}
      - PGID=${MEDIA_PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${WATCH}:/downloads
      - ${CONFIG_DIR}/jackett:/config

  radarr:
    image: ghcr.io/linuxserver/radarr:latest
    environment:
      - TZ=${TZ}
      - PUID=${MEDIA_PUID}
      - PGID=${MEDIA_PGID}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/radarr:/config
      - ${MOVIES_DIR}:/movies
      - ${DOWNLOADS}/complete:/downloads/complete
    ports:
      - 20012:7878
    restart: "unless-stopped"
    depends_on:
      - jackett
      - plex
      - proxy
    networks:
      - backend

  sonarr:
    image: ghcr.io/linuxserver/sonarr:latest
    restart: "unless-stopped"
    depends_on:
      - jackett
      - plex
      - proxy
    ports:
      - 20013:8989
    environment:
      - TZ=${TZ}
      - PUID=${MEDIA_PUID}
      - PGID=${MEDIA_PGID}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/sonarr:/config
      - ${TV_DIR}:/tv
      - ${DOWNLOADS}/complete:/downloads/complete 
    networks:
      - backend

  bazarr:
    image: ghcr.io/linuxserver/bazarr:latest
    restart: "unless-stopped"
    depends_on:
      - jackett
      - proxy
      - sonarr
      - radarr
    ports:
      - 20014:6767
    environment:
      - PUID=${MEDIA_PUID}
      - PGID=${MEDIA_PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/bazarr:/config
      - ${TV_DIR}:/tv
      - ${MOVIES_DIR}:/movies
    networks:
      - backend

  lidarr:
    image: ghcr.io/linuxserver/lidarr:latest
    restart: "unless-stopped"
    depends_on:
      - jackett
      - proxy
      - plex
    ports:
      - 20015:8686
    environment:
      - PUID=${MEDIA_PUID}
      - PGID=${MEDIA_PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/lidarr:/config
      - ${MUSIC_DIR}:/music
      - ${DOWNLOADS}/complete:/downloads/complete 
    networks:
      - backend
